<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN">
  <Appenders>
    <!-- Console output -->
    <BetterFabricConsoleAppender name="Console">
      <PatternLayout pattern="%highlight{[%d{HH:mm:ss} %level] [%t]: [%logger{1}]}{FATAL=red, ERROR=red, WARN=yellow, INFO=default, DEBUG=yellow, TRACE=blue} %legacyMinecraftFormatting{%msg{nolookups}}%n"/>
    </BetterFabricConsoleAppender>

    <!-- Endermux log forwarding (only used if enabled) -->
    <EndermuxForwardingAppender name="Endermux">
      <PatternLayout pattern="%highlight{[%d{HH:mm:ss} %level] [%t]: [%logger{1}]}{FATAL=red, ERROR=red, WARN=yellow, INFO=default, DEBUG=yellow, TRACE=blue} %legacyMinecraftFormatting{%msg{nolookups}}%n"/>
    </EndermuxForwardingAppender>

    <!-- Server GUI console output -->
    <Queue name="ServerGuiConsole">
      <PatternLayout pattern="[%d{HH:mm:ss} %level]: [%logger{1}] %EndermuxStripAnsi{%msg{nolookups}}%n"/>
    </Queue>

    <!-- Default log file handling -->
    <RollingRandomAccessFile name="File" fileName="logs/latest.log" filePattern="logs/%d{yyyy-MM-dd}-%i.log.gz">
      <PatternLayout pattern="[%d{HH:mm:ss}] [%t/%level]: [%logger{1}] %EndermuxStripAnsi{%msg{nolookups}}%n"/>
      <Policies>
        <TimeBasedTriggeringPolicy/>
        <OnStartupTriggeringPolicy/>
      </Policies>
    </RollingRandomAccessFile>

    <!-- Tracy log forwarding (debugging tool added by Vanilla) -->
    <Listener name="Tracy">
      <PatternLayout pattern="(%F:%L): %EndermuxStripAnsi{%msg{nolookups}}%n"/>
    </Listener>

    <!-- Async appender - Don't block logging thread on slow appenders -->
    <Async name="Async">
      <AppenderRef ref="Console"/>
      <AppenderRef ref="Endermux"/>
      <AppenderRef ref="File"/>
      <AppenderRef ref="ServerGuiConsole"/>
      <AppenderRef ref="Tracy"/>
    </Async>
  </Appenders>

  <Loggers>
    <Root level="${sys:better-fabric-console.log.level:-info}">
      <filters>
        <MarkerFilter marker="NETWORK_PACKETS" onMatch="DENY" onMismatch="NEUTRAL"/>
      </filters>
      <AppenderRef ref="Async"/>
    </Root>
  </Loggers>
</Configuration>
